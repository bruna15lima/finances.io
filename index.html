<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,400;0,700;1,100&display=swap" rel="stylesheet">
  <title>Document</title>
</head>

  <body> 

    <header>
     <img src="./assets/logo.svg" alt="Logo Dev Finance">    
     <div class="container1">
      
      <div class="toggle">
          <input id="switch" type="checkbox" name="theme">
          <label for="switch">Toggle</label>          
      </div> 
    </header>
   

    <main class="container">   

      <section id="balance">
        <h2 class="sr-only">Balanço</h2>
        <div class="card">          
          <h3>
            <span>Entradas</span>
            <img src="./assets/income.svg" alt="imagem de Entradas">
          </h3>
          <p id= "incomeDisplay">R$ 0,00</p>      
        </div>
        
        <div class="card">          
        <h3>
          <span>Saídas</span>
          <img src="./assets/expense.svg" alt="imagem de Entradas">
        </h3>
        <p id="expenseDisplay">- R$ 0,00</p>      
        </div>

       <div class="card blue">          
        <h3>
          <span>Total</span>
          <img src="./assets/total.svg" alt="imagem de Entradas">
        </h3>
        <p id= "totalDisplay">R$ 0,00</p>
       </div>
      </section>

      <section id="transaction">
      <h2 class="sr-only">Transações</h2>
      <a href="#" 
      onclick="Modal.open()"
      class="button new">+ Nova Transação</a>
  
    <table id="data-table">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Valor</th>
          <th>Data</th>
          <th></th>
        </tr>
      </thead>
      <tbody>          
      </tbody>
    </table>
    </section>
  
           
</main>

<div class="modal-overlay">
  <div class="modal">
   <div id="form">
     <h2>Nova Transação</h2>
     <form action="" onsubmit="Form.submit(event)">
       <div class="input-group">
         <label class="sr-only"
          for="description">Descrição</label>
          <input 
          type="text" 
          id="description" 
          name="description"
          placeholder="Descrição"
          />
        </div>

        <div class="input-group">
          <label class="sr-only"
           for="amount">Descrição</label>
           <input 
           type="number" 
           step="0.01"
           id="amount" 
           name="amount"
           placeholder="Descrição"
           />        
         <small class="help">use o sinal - (negatino) para 
            despesas e, (vírgula) para casa decimais</small>
         </div>

         <div class="input-group">
          <label class="sr-only"
           for="date">Data</label>
           <input 
           type="date" 
           id="date" 
           name="date"          
           />
         </div>

         <div class="input-group actions">
           <a 
           onclick="Modal.close()"
           href="#" 
           class="button cancel">Cancelar</a>
            <button>Salvar</button>
         </div>
     </form>
   </div>
  </div>
</div>


<script src="./script.js">
const Modal = {
  open(){
    //Abrir modal
    //Adicionar a class active ao modal
    document
      .querySelector('.modal-overlay')
      .classList
      .add('active')
  },
  close(){
    //Fechar modal
    // remover a class active do modal
    document
      .querySelector('.modal-overlay')
      .classList
      .remove('active')
  }
}

const Storage = {
  get() {
    return JSON.parse(localStorage.getItem("dev.finances:transactions")) ||
    []
  },

  set(transactions) {
    localStorage.setItem("dev.finances:transactions", JSON.stringify(transactions))
  }
}
  //eu preciso somar as entradas
  //depois eu preciso somar as saídas e
  // remover das entradas o valor das saídas
  // assim, eu terei o total
  
const Transaction = {
    all:  Storage.get(),
    
    add(transaction){
      Transaction.all.push(transaction)
      
      App.reload()
    }, 

    remove(index) {
      Transaction.all.splice(index, 1)
      
      App.reload()
    },

    incomes() {
      let income = 0;
      //somar as entradas
      Transaction.all.forEach(transaction =>{
        if(transaction.amount > 0){
          income += transaction.amount;
        }
      })
      return income;
    },
    
    expenses() {
      let expense = 0;
      //somar as entradas
      Transaction.all.forEach(transaction =>{
        if(transaction.amount < 0){
          expense += transaction.amount;
        }
      })
      
      // somar as saídas
      return expense;
    },

    total() {
      //entradas - saídas
      return Transaction.incomes() + Transaction.expenses();
    }
}

const Form = {
  description: document.querySelector('input#description'),
  amount: document.querySelector('input#amount'),
  date: document.querySelector('input#date'),

  getValues(){
    return {
      description: Form.description.value,
      amount: Form.amount.value,
      date: Form.date.value      
    }
  },

  //formatData(){
  //},

  validateFields(){
    const { description, amount, date } = Form.getValues()
    
    if( description.trim() === "" || 
        amount.trim() === "" || 
        date.trim() === "") {
          throw new Error("Por favor, preencha todos os campos")
    }
  },

  formatValues() {
    let { description, amount, date } = Form.getValues() 
    
    amount = Utils.formatAmount(amount)
    
    date = Utils.formatDate(date)

    return{
      description,
      amount,
      date
    }
  },

  clearFields() {
    Form.description.value = ""
    Form.amount.value = ""
    Form.date.value = ""
  },

  submit(event) {
    event.preventDefault()

    try {
        //Vereficar todas as informações foram preenchidas
        Form.validateFields() //formatar os dados para salvar
        const transaction = Form.formatValues()//apagar os dados do formulario ->//salvar
        Transaction.add(transaction)
        Form.clearFields()
        Modal.close()      //modal feche ->  Atualizar a App
    } catch (error) {
      alert(error.message)
    }    
  }
}

const html = document.querySelector("html")
const checkbox = document.querySelector("input[name=theme]")

const getStyle = (element, style) => 
    window
        .getComputedStyle(element)
        .getPropertyValue(style)


const initialColors = {
    bg: getStyle(html, "--bg"),
    bgPanel: getStyle(html, "--bg-panel"),
    colorHeadings: getStyle(html, "--color-headings"),
    colorText: getStyle(html, "--color-text"),
}

const darkMode = {
    bg: "#333333",
    bgPanel: "#434343",
    colorHeadings: "#3664FF",
    colorText: "#d5d6d8"
}

const transformKey = key => 
    "--" + key.replace(/([A-Z])/, "-$1").toLowerCase()


const changeColors = (colors) => {
    Object.keys(colors).map(key => 
        html.style.setProperty(transformKey(key), colors[key]) 
    )
}


checkbox.addEventListener("change", ({target}) => {
    target.checked ? changeColors(darkMode) : changeColors(initialColors)
})

  //Substituir os dados do html com os
  //dados do Javascript
  //Objeto no Javascript
  //Colocar no HTML

const DOM = {
 transactionsContainer: document.querySelector('#data-table tbody'),  
  
 addTransaction(transaction, index) {      
      const tr =  document.createElement('tr')
      tr.innerHTML = DOM.innerHTMLTransaction(transaction, index)      
      tr.dataset.index = index

      DOM.transactionsContainer.appendChild(tr)
      //console.log(tr.innerHTML)
  },
  innerHTMLTransaction(transaction, index) {
      const CSSclass = transaction.amount > 0 ? "income" : "expense"

      const amount = Utils.formatCurrency(transaction.amount)

      const html = `      
          <td class="description">${transaction.description}</td>
          <td class="${CSSclass}">${amount}</td>
          <td class="date">${transaction.date}</td>
          <td>
            <img onclick="Transaction.remove(${index})" src="./assets/minus.svg" alt="Remover Transação">
          </td>      
      `
      return html

  }, 

  updateBalance() {
    document
     .getElementById('incomeDisplay')
     .innerHTML = Utils.formatCurrency(Transaction.incomes())
    document
     .getElementById('expenseDisplay')
     .innerHTML = Utils.formatCurrency(Transaction.expenses())
    document
     .getElementById('totalDisplay')
     .innerHTML = Utils.formatCurrency(Transaction.total())

  },
  
 clearTransactions() {
    DOM.transactionsContainer.innerHTML = ""
  }
}
  
 const Utils = {
   formatAmount(value){
     value = value * 100
     
     return Math.round(value)
   },

   formatDate(date){
    const splittedDate = date.split("-")
    return `${splittedDate[2]}/${splittedDate[1]}/${splittedDate[0]}`

   },

   formatCurrency(value) {
    const signal = Number(value) < 0 ? "-" : ""

    value = String(value).replace(/\D/g, "")

    value = Number(value) / 100
    
    value = value.toLocaleString("pt-BR",{
      style:"currency",
      currency:"BRL"
    })

    return signal + value
   }
}

const App = {
  init() {

    Transaction.all.forEach(DOM.addTransaction)    
      
    Storage.set(Transaction.all) 

    DOM.updateBalance()    

  },
    reload() {
      DOM.clearTransactions()
      App.init()
    },
  
}

  App.init();


</script>
  

<footer><p>2021 - dev.finance$ - @bruna15lima</p></footer>
</body>
</html>